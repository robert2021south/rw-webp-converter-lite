jQuery(function ($) {

    // 扫描按钮
    $('#rwiol-scan-btn').on('click', function () {
        $(this).prop('disabled', true).text('Scanning...');

        $.post(ajaxurl, {
            action: 'rwiol_scan_images',
            nonce: rwiol_object.nonce
        }, function (response) {
            $('#rwiol-scan-btn').prop('disabled', false).text('Scan Unoptimized Images');

            if (!response.success) {
                alert('Scan failed.');
                return;
            }

            alert('Found ' + response.data.count + ' unoptimized images.');

            $('#rwiol-start-bulk-btn').prop('disabled', response.data.count == 0);

        });
    });

    // 批量优化按钮
    $('#rwiol-start-bulk-btn').on('click', function () {
        $(this).prop('disabled', true).text('Optimizing...');

        $.post(ajaxurl, {
            action: 'rwiol_bulk_optimize',
            nonce: rwiol_object.nonce
        }, function (response) {
            if (!response.success) {
                alert('Optimization failed.');
                return;
            }

            alert('Optimization complete. Total optimized: ' + response.data.optimized);

            location.reload();
        });
    });

});
